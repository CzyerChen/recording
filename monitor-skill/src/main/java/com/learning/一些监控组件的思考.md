> 今天再次关注到了一下一些组件，在过去的经历当中也对部分组件有所了解，今天会将对它们在监控领域的能力做出一些思考


### 一、什么Kibana?
- 一个实时的数据可视化分析平台
- 可以进行日志的全文分析
- 可以进行监控指标分析
- 可以进行数据关联关系的探索
- 可以进行信息图表的实时幻灯片展示
- 可以对整个Elastic Stack进行运维和管理

#### 历史总是历经波折
- Kibana 1.0 的作者是 Rashid Khan 于 2011 年编写的，用的 PHP
- 然后由于使用不畅，第二年又用 Ruby 重写了 Kibana 2.0
- 但是并不满意，一年后，用 AngularJS，Html+JS 再重写
- 但是由于数据安全性和数据渲染的技术性问题，2014年，Kibana4 又完全用 NodeJS 重写了一遍

#### 优点
- 丰富美观的可视化界面
- 支持全文索引，实时查询与分析
- 易于安装和配置
- 支持在Linux，Mac，Windows，Docker上安装或从源代码构建
- 可通过文件进行配置

#### 缺点
- 缺乏免费的用户管理和报警措施


### 二、什么是Grafana?
- Grafana 是一个开源的时序性统计和监控平台，支持例如 elasticsearch、graphite、influxdb 等众多的数据源，并以功能强大的界面编辑器著称
- 可以同时兼顾多种形式的时序数据
- 可以使用丰富的插件，建立美观多样的可视化报表，进行数据分析

#### 优点
- 丰富美观的可视化界面
- 自身支持用户管理
- 能够对接邮件、钉钉等进行实时报警
- 易于安装和配置
- 支持在Linux，Mac，Windows，Docker上安装或从源代码构建
- 可通过文件进行配置，还能够分环境使用

#### 缺点
- 并不能够支持全文检索


### 三、 Grafana VS Kibana
- 均含有丰富的可视化图表
- 均易于安装和配置，能在Linux，Mac，Windows，Docker上安装或从源代码构建
- Kibana支持全文检索，Grafana支持实时报警和用户管理
- kibana的社区活跃度比Grafana略高，grafana的资料相对较少
- Kibana更擅长于日志分析并作可视化，Grafana更适合整合多种数据源做指标性分析并做可视化
- 两者都有彼此没有的功能，需要各取所需

### 四、微服务监控的痛点
1.	**配置难**：监控对象动态可变，无法进行预先配置； 
2.	**融合难**：监控范围非常繁杂，各类监控难以互相融合； 
3.	**排查难**：微服务实例间的调用关系非常复杂，故障排查会很困难； 
4.	**建模难**：微服务架构仍在快速发展，难以抽象出稳定的通用监控模型。

### 五、什么是Prometheus？
- Prometheus是一套完整的开源监控告警系统
- 迎合于当下云计算的背景，能够很好地面向容器和服务做监控

#### 优点
- 面向服务：能够做任何维度的统计，而不是单纯绑定在一个ip或者主机上，Prometheus对于业务如，订单量，库存量，以及物联网的设备都能非常好的进行数据收集和监控
- 复杂分析能力：所有的在一个用户下的数据都可以做完全交叉的分析和计算，如我们甚至可以把打印机的纸张变化和CPU的负载去做一些联合观察并且可以做相对复杂的计算，如取一定时间数据的变化率，方差等等基于统计学的分析函数
- 安全性：Prometheus 到exporter 是单向通信关系，不可能向这个Exporter下发任何的指令，因此即便是Prometheus被黑客入侵，或者工作人员掌握Prometheus的中心节点并不不会对其监控的对象执行任何的写操作
1.  灵活的数据模型：
在 Prometheus 里，监控数据是由值、时间戳和标签表组成的，其中监控数据的源信息是完全记录在标签表里的；同时 Prometheus 支持在监控数据采集阶段对监控数据的标签表进行修改，这使其具备强大的扩展能力；
2.  强大的查询能力：
Prometheus 提供有数据查询语言 PromQL。从表现上来看，PromQL 提供了大量的数据计算函数，大部分情况下用户都可以直接通过 PromQL 从 Prometheus 里查询到需要的聚合数据；
3.  健全的生态：
Prometheus 能够直接对常见操作系统、中间件、数据库、硬件及编程语言进行监控；同时社区提供有 Java/Golang/Ruby 语言客户端 SDK，用户能够快速实现自定义监控项及监控逻辑；
4.  良好的性能：
Prometheus 提供了 PromBench 基准测试，从最新测试结果来看，在硬件资源满足的情况下，Prometheus 单实例在每秒采集 10万条监控数据的情况下，在数据处理和查询方面依然有着不错的性能表现；
5.  更契合的架构：
采用推模型的监控系统，客户端需要负责在服务端上进行注册及监控数据推送；而在 Prometheus 采用的拉模型架构里，具体的数据拉取行为是完全由服务端来决定的。
服务端是可以基于某种服务发现机制来自动发现监控对象，多个服务端之间能够通过集群机制来实现数据分片。
推模型想要实现相同的功能，通常需要客户端进行配合，这在微服务架构里是比较困难的。

#### 缺点
- 不能用于日志监控、分布式追踪
- 作为一个开源软件，其本身安装部署并不友好，如报警，图形展示均需要单独部署安装
- 没有安全认证的功能，UI非常简单
- 具有一定的上手门槛，需要公司内部有相对应了解其原理的编程人员，主要是支持自定义Exporter
- 虽然有强大的表达式，但也有学习的门槛，相对于Zabbix这种UI操作，编程模式要求高

#### 如何改进和集成？
- 集成认证系统
- 集成grafana,做丰富的图形化展示
- 集成告警系统，做自定义自动化告警


### 六、什么是Elasticsearch?
- 是一个支持全文检索的文档式数据库
- 能够进行分词检索
- 利用倒排索引，能够快速地实现数据的定位
- 含有丰富的统计函数

### 七、什么是Zabbix?
- 老牌的监控告警系统
- 面向服务器、面向IP，灵活地通过自定义配置，实现不同指标的收集

#### 优点
- 稳定，自定义丰富
- 可插拔，能够与物理机建立最真实有效快速的监控
- 能够简单配置，轻松告警
- 入门门槛低，采用最广泛的mysql作为底层数据库，agent的配置也很简单，采用简单的操作系统命令即可

#### 缺点
- 由于出道之早，所以对当下云计算领域的监控可能略心有余而力不足
```text
  1. 对云计算除主机外服务数据收集和监控
  
  2. 对容器编排这种跨宿主机的对象持续的数据收集和监控
  
  3. 对Paas或Saas类的服务进行数据收集和监控
  
  4. 对业务系统，IOT进行数据收集和监控
```
- 操作指标比较简单：对于Zabbix来说，只能实现简单的数据展示，如果CPU，内存等，同时是通过自定义模版或脚本的方式来实现告警，由于其本身数据存储平台基于Mysql，加之基于主机的束缚，导致其根本无法做复杂的计算和针对有效的场景进行分析和故障提示，只能实现一般意义上的监控，由于可以依赖的数据不足，同时需要大量人为的判断才能有效的定位问题。
- 缺乏安全性考虑，适合内网部署：相对于Prometheus，zabbix存在安全性问题，Zabbix存在主动和被动的双模式，但其本质上都是与agent建立双向连接，由Zabbix中心向这些Zabbix Agent下发指令来实现管理和控制,那将涉及服务器内容，造成致命问题


### 八、Prometheus Zabbix之间有什么不同？
- 两者都是监控告警系统
- Prometheus 面向服务，适用于云计算领域，结合多种时序数据库，与exporter单向通信，擅长复杂的指标计算，并自定义告警
- Zabbix 面向物理机，与agent双向通信，擅长简单的系统指标的搜集，和一些基于操作系统的应用指令，自定义告警
- Prometheus 入门门槛较高，Zabbix 入门门槛较低

### 九、Grafana + Prometheus
- [搭建参考](https://yq.aliyun.com/articles/236395)
- [组合监控redis](https://yq.aliyun.com/articles/251478?spm=a2c4e.11153940.0.0.5a1dabb9bMgtx2)
- [组合监控mysql](https://yq.aliyun.com/articles/251561?spm=a2c4e.11153940.0.0.5a1dabb9bMgtx2)
- [钉钉收告警](https://yq.aliyun.com/articles/250063?spm=a2c4e.11153940.0.0.5a1dabb9bMgtx2)
- 监控Kubernates集群
- 结合docker进行快速部署
- 监控spring cloud 服务指标
- [监控springboot服务指标](https://yq.aliyun.com/articles/664698?spm=a2c4e.11153940.0.0.5a1dabb9bMgtx2)

### 十、Grafana + Elasticsearch
- 对es里面的单字段做统计，相对于灵活性不是特别好


### 十一、Grafana + Zabbix 
- grafana-zabbix可以有插件可以下载，就能够实现数据源是zabbix的操作，并且可以选择默认的zabbix dashboard,就能够快速呈现图表

### 参考
- [kibana grafana的异同](https://blog.csdn.net/peterwanghao/article/details/84594127)
- [kibana grafana的讨论](https://www.zhihu.com/question/54388690/answer/411123602)
- [搭建步骤](https://www.cnblogs.com/weavepub/p/10959208.html)
- [prometheus 搭建详情](https://blog.csdn.net/lijiaocn/article/details/81865120;https://www.lijiaocn.com/项目/2018/08/03/prometheus-usage.html)