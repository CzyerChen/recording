- 学习了JMM的初步知识，让我们继续探究重排序
- 学习资源来自互联网和并发编程网（ 转载自并发编程网 – ifeve.com  深入理解Java内存模型）

#### 1.概念：数据依赖性
- 如果两个操作访问同一个变量，且这两个操作中有一个为写操作，此时这两个操作之间就存在数据依赖性
- 有三种情况，读写，写读，写写，对于这三种情况，因为存在写，只要顺序改变，结果就会不同
- 之前也提到编译器和处理器会进行指令重排，那么这种顺序会被破坏吗？其实是不会的，它们在重排序的时候，会遵循数据依赖性的原子，编译器和处理器并不会改变这种执行顺序
- 但是以上所谓了数据依赖性，仅限于单处理器和单线程之内，多处理器并不保证

#### 2.as-if-serial语义
- 不管怎么重排序，程序的执行结果不能被改变。编译器，runtime 和处理器都必须遵守as-if-serial语义
- 为了遵守as-if-serial语义，编译器和处理器不会对存在数据依赖关系的操作做重排序
```text
A: double a =1;
B: double b =2;
C: double c = a+b;

其中，A,B不存在数据依赖，可以交换指令顺序，C依赖A，C依赖B，所以C的指令不可能在A和B之前
```

#### 3.程序顺序规则
- 继续说明一个点：JMM 仅仅要求前一个操作（执行的结果）对后一个操作可见，且前一个操作按顺序排在第二个操作之前。
- 当A,B操作并不需要互相数据可见，在步骤C之前，无论是AB还是BA都可以将两者的结果刷新到内存，供C使用即可，因而允许AB指令的重排
- 软件技术和硬件技术有一个共同的目标：在不改变程序执行结果的前提下，尽可能的开发并行度，重排序的目的就是为了提高并行度

#### 4.重排序对多线程的影响
- 在单线程程序中，对存在控制依赖的操作重排序，不会改变执行结果；但在多线程程序中，对存在控制依赖的操作重排序，可能会改变程序的执行结果
- 多线程中，对于单个线程中的无依赖指令会被重排，多个线程之间的前后顺序更加不可捉摸，因而重排序对多线程是影响很大的


