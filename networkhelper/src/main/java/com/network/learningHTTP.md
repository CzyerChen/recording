> 从前觉得我就是码代码的，那些网络的知识，知道有哪几层就行了，还用管网络里面怎么流转的吗，但是渐渐地，了解了一些前端，接触了架构，才发现需要对所有部件大体的认知，一个也不能差

> 不知所以然的事情，不是铤而走险，就是破绽百出

HTTP: HyperText Transfer Protocol 超文本传输协议

### 一、什么是TCP/IP
1.TCP/IP协议族，不是就是指TCP或者IP协议，它是指与它们相关的各种协议，包括有HTTP, FTP, DNS, TCP, UDP, IP, SNMP等等都属于TCP/IP协议族

- FTP File Transfer Protocol: 文件传输协议，传输文件
- DNS Domain Name System: 域名系统，域名解析，需要识别到用户输入的www.baidu.com对应的实际IP，通过DNS可以将域名与IP地址进行相互的转换
- TCP Transmission Control Prococol:传输控制协议，通过ACK确保数据的准确发送
- UDP User Data Protocol: 用户数据协议，不能确保数据的准确发送
- IP(Internet Protocol: 网际协议

2.TCP/IP分层：这就是我停留在网络层面的认知
- OSI标准中的7层，包括应用层、表示层、会话层、传输层、网络层、数据链路层、物理层
- TCP/IP协议族有4层，包括应用层、传输层、网络层、链路层

- 应用层：面向用户的一层，也就是说用户可以直接操作该层，该层决定了向用户提供应用服务时的通信活动，HTTP\FTP\DNS\SMTP\POP3都位于这一层
- 传输层：传输层在应用层的下方，应用层会将数据交付给传输层进行传输，此处TCP会通过三次握手四次挥手进行数据的传输，TCP/UDP在这一层
- 网络层：网络层在传输层的下方，来处理在网络上流动的数据包，IP在这一层，需要在网络线路中选择一条传输线路 IP\ARP\ICMP\HDLC
- 链路层：链路层就是负责最底层的数据传输啦，用于除了网络硬件部分，包括数据链路层和物理层，包含网卡、光纤、控制操作系统、硬件设备驱动、NIC等

3.TCP/IP协议中数据如何交互，如何封包解包
- 发送端，根据分层添加首部标识的方式，生成传输报文, 在HTTP工作开始之前，客户机（Web浏览器）首先要通过网络与服务器建立连接，该连接是通过TCP来完成的
    - 应用层接收到HTTP数据，添加TCP首部，发送到传输层
    - 传输层收到报文后，添加IP数据包，发送到网络层
    - 网络层收到报文后，添加网络架构后，发送到链路层
- 通过网络的发送， 接收端通过一层层删除首部，拿到指定的数据
    - 链路层拆除网络架构，传给网络层
    - 网络层拆除IP数据包，发送给传输层
    - 传输层拆除TCP首部，发送给应用层
    - 应用层获取对应的http数据

4.TCP协议非常有名的就是三次握手四次回收的爱情故事
- TCP协议正是依靠上面的机制，才确保了数据的传输，包括发送报文前和结束发送报文后
- 前提说明：
    - 最开始连接是属于CLOSED状态，主动连接的是客户端，被动打开连接的是服务端
    - 通信主要涉及几个字段ACK判断是否接收到请求，SYN同步位，seq序列号，ack确认序列号
    - TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号
    - TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号
- 以上是一些规则，接下来看三次握手流程：
    - TCP服务器进程先创建传输控制块TCB，准备接收请求，服务器就进入了LISTEN（监听）状态
    - (1)TCP客户进程先创建传输控制块TCB，然后向服务端发送请求报文：SYN=1,seq=m,客户端进入SYN-SENT（同步已发送状态）状态，消耗序列号
    - (2)TCP服务器收到请求报文后，同意连接，发出确认报文，ACK=1,SYN=1,ack=m+1,seq=n
    - (3)TCP客户进程收到确认后，还要向服务器给出确认,ACK=1,SYN=1,ack=n+1,不消耗序列号，客户端进入ESTABLISHED（已建立连接）状态
    - 服务端收到确认消息后也进入ESTABLISHED（已建立连接）状态
    - 最后一次握手主要防止已经失效的连接请求报文突然又传送到了服务器，从而产生错误
```text
建立TCB                          被动建立TCB
  client CLOSRD  --------(1)------------> server LISTEN
  
  client SYN-SENT <-------(2)------------- server LISTEN
  
  client SYN-SENT --------(3)------------> server SYN-RCVD
  
  client          <-----establish-------->  server
```
- TCP的四次挥手流程：
    - 一些规定： TCP规定，FIN报文段即使不携带数据，也要消耗一个序号
    - 包含的字段SYN FIN ack seq
    - 首先，双方都是ESTABLISH状态
    - (1)客户端进程发出连接释放报文，并且停止发送数据,FIN=1,seq=x,户端进入FIN-WAIT-1（终止等待1）状态
    - (2)服务器收到连接释放报文，发出确认报文,ACK=1，ack=x+1,seq=y,服务端就进入了CLOSE-WAIT（关闭等待）状态
    - 以上CLOSR_WAIT状态是很多连接应用在释放的时候，查看网络状态都会出现的问题
    - TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受
    - 客户端收到服务器的确认请求后,客户端就进入FIN-WAIT-2（终止等待2）状态
    - (3)服务器将最后的数据发送完毕后发送释放报文，FIN=1，ACK=1,seq=z,ack=y+1,服务器进入LAST-ACK（最后确认）状态，等待客户端的确认
    - (4)客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=z+1，自己的序列号是seq=x+1,客户端就进入了TIME-WAIT（时间等待）状态
    - 此时TCP连接还没有释放，须经过2∗ *∗MSL（最长报文段寿命）的时间后，客户端撤销相应的TCB后，才进入CLOSED状态
    - 服务端在此确认收到客户端的报文后，立即进入CLOSED状态，撤销TCB后，结束TCP连接
    - MSL（Maximum Segment Lifetime），TCP允许不同的实现可以设置不同的MSL值
    - 由于服务器会考虑最后一次的确认断开报文如果客户端没有收到，就会发送两次，因而客户端只有在过了这两次报文发送时间之后，才能断定是断开了
```text
  client <-----establish-------->  server
  主动关闭                        通知应用关闭-->被动关闭
  client FIN-WAIT1 --------(1)------------> server CLOSE-WAIT
                                 
  client FIN-WAIT2 <-------(2)------------- server CLOSE-WAIT
  
  client FIN-WAIT2 <--------(3)------------ server LAST-ACK
  
  client TIME-WAIT ---------(4)------------>  server CLOSED
  
  client 等待2MSL -> CLOSRD
```    


### 二、 什么是HTTP 
- http就是一种通信协议，是没有状态的，它不会记录上一个请求是谁发来的，不会对通信状态保存，这样就能大大提高http的时间处理
- http不够安全，通信使用明文，不验证通信方身份
- 但是我们在通信交互过程中，我们会想知道是谁发的消息，那就出现了cookie 技术
- 要是服务器端想要记住客户端是谁，那么就颁发一个cookie给客户端
- 客户端把Cookie保存在硬盘中，当下次访问服务器的时候，浏览器会自动把客户端的cookie带过去，这样就能通信了

### 三、HTTP 0.9/1.0/1.1/2.0，你跟上脚步了吗？
- 在http1.0的时候，一次请求结束后就会断开，不会持续，当一次页面需要请求大量数据，就要连续建立连接，断开链接，销毁资源，又申请资源，非常不利于资源的管理
- Http 1.1开始这个单次请求连接就就改成持续连接，能够一次加载多个请求的数据，是管道化的，是顺序的
- Http 2.0开始，这个持续连接的请求改成了并行化，不再是顺序的，一个请求有多个资源是并行去请求的

### 四、http中的压缩技术
- 使用压缩技术把实体主体压小，在客户端把数据解析
- 使用分块传输编码，将实体主体分块传输，当浏览器解析到实体主体就能够显示
- 在下载东西的过程中断了，以前是只能够重新下载了，但是现在可以中断处继续下载。可以使用到获取范围数据，这是范围请求


### 五、HTTP的报文详情
- 报文的内容有人问，重要吗？这不仅是重要，也是基础的，需要会看，懂的是什么意思，有哪些字段，在服务器接收和发送请求的时候需要怎么放置参数

#### 1.请求报文
- HTTP报文包括：方法、URI、HTTP版本、HTTP首部字段等


#### 2.响应报文
### 六、HTTP的请求方法与响应状态码
- 正常请求
200正常
204正常，无数据返回，无需刷新页面
206范围请求

- 重定向
301 永久重定向
302 页面转发
303 页面转发，get方式获取资源
304 发送附带请求，但不符合要求
307 页面转发 ，post请求不会变成get

- 请求出错
400 请求报文语法错误
401 需要认证身份
403 没有权限访问
404 服务器没有这个资源

- 服务器系统出错
500 内部资源出错
503 服务器正忙


### 五、HTTP 代理原理及实现



HTTP详解(1)-工作原理

TCP、IP协议族之数字签名与HTTPS详解

【HTTP】HTTPS 原理详解

HTTPS协议详解(二)：TLS/SSL工作原理

HTTPS原理及交互过程
HTTPS 原理解析

http 和 https 有何区别？如何灵活使用？

HTTPS原理及OKHTTP对HTTPS的支持

HTTP/2 幕后原理








