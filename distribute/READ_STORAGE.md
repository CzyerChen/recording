### 一、分布式存储现状
1. 特点：可扩展 低成本 高性能 易用；
2. 挑战： 数据和状态信息的自动迁移，自动容错，并发读写中保持数据一致性；
3. 技术点：数据分布、一致性、容错、负载均衡、事务与并发控制、易用性、压缩/解压缩；

### 二、分布式存储分类
1. 非结构化数据（文件图片）
2. 结构化数据
3. 半结构化数据（html等）

### 三、分布式系统分类
1.分布式文件系统

分布式文件系统（非结构化数据）：Blob -- binary large Object，二进制大文件 TFS GFS EBS 
一般存储大文件、定长块、Blob对象;

2.分布式键值系统

分布式键值系统（存储关系简单的半结构化数据） --- 一致性哈希，是分布式表格的一种简化，一般用于缓存;

3.分布式表格系统

分布式表格系统（存储关系相对复杂的半结构化数据）---- 只支持单表操作;

4.分布式数据库

分布式数据库系统（由传统单机发展而来）--- Mysql数据库分片，Amazon RDS ,Microsoft Azure;


### 四、单机存储引擎
- 单机存储引擎----是哈希表、B树在机械磁盘、SSD等持久化介质上的实现。
- 单机存储引擎有：哈希存储引擎、B树存储引擎、LSM（log Structure Merge Tree）存储引擎

### 五、B树存储引擎
- Mysql InnoDB引擎:B+树（B树存储引擎的一种）：非叶子节点存储索引数据，叶子节点存储完整的数据。

- Mysql 缓冲区管理---- 缓冲区管理器将可用内存划分成缓冲区，磁盘块内容可以将内容传送到缓冲区，缓冲区是与页同样大小的区域。
    - 一般缓冲区采用LRU策略，最近最少使用，符合条件的被置换，一般效果都比较好
    - 但出现全表扫描的时候，会出现原缓冲区大量数据被置换，从而污染缓冲区
    - 因而现在一般使用LIRS,将数据库分为两级，进入一级满足一定条件才（短时间被访问两次）可以进入二级
    - 每一级内部还是采用LRU算法进行置换，Mysql InnoDB 内部就采用了新子链表（5/8）和老子链表（3/8），先进入老子链表，需要停留超过1S或者一定时间，才能进入新子链表，采用了这种策略防止缓冲区被污染。

### 六、LSM存储引擎
- LSM存储引擎：例子是Google LevelDB；
- 包含可变和不可变的MemTable，达到一定条件后，不可变的MemTable转为外部存储的SSTable文件；
- 写操作先写入可变MenTable, 而后将可变MenTable冻结成不可变的MenTable，然后再生成一个可变的MenTable,LevelDB后台线程将不可变的MenTable存储到磁盘，然后写入到一个SSTable文件，按照主键排序；
- 合并的操作有两种：
    - 一种Minner合并，是内存中MenTable达到一定值时，将内存数据转储到SSTable中；
    - 一种是Major合并，是一个层级下有多个SSTable, 当数量超过一定值时，会将SSTable向上合并，相当于多路归并；
    
### 七、数据事务
同数据库事务类似、面临的事务问题、事务的隔离级别

### 八、数据层面的并发控制
数据层面的并发控制主要有：
1.数据库锁：读锁，写锁，读写锁
- 读锁可以同时加，写锁只能加一个，读写锁也是在写的时候只能加一个；
- 加锁会造成两个问题，一个消耗性能，一个可能造成死锁；

那么死锁的解决办法：
1）设置超时机制，每个事务设置一个超时时间。一个事务超时解锁后就不会影响别的事务继续执行了；
2）设置死锁检测机制，死锁检测主要检查事务之间有没有形成依赖的环路，来避免或者破环环路避免死锁；

2.对于加锁这种耗时耗性能的操作，可以通过其他灵活的操作实现，比如写时复制。
一般读事务使用的数量会大大超过写事务，因而写时复制能够大大减少所带来的消耗，大大提高性能。步骤如下：
1）拷贝：将叶子界面到根节点的路径拷贝出来；
2）修改：对拷贝节点进行修改；
3）提交：原子地切换根结点的指针，使之指向新的根节点；

写时复制涉及引用计数，主要是计算节点被引用的次数，当次数为0 的时候，垃圾数据可以被回收，对于读操作，可以提高性能，但是写操作的成本较高，并且写操作是互斥的

3.多版本并发控制MVCC
MVCC是对每一行数据维护多个版本号，事务的执行关乎对应的版本号，因而不用加锁就能够读取正确的数据。Mysql InnodeDB引擎每一行数据就维护了数据修改版本号和删除版本号，这个版本号是相对于数据库而言的一个递增整数，与时间戳之类的无关，每次查询都会将事务号与版本号对比，对于SELECT就比较事务号需要大于等于修改版本号，并且删除版本号没有定义，对于INSERT就更新修改版本号为事务号，对于DELETE就更新删除版本号，对于UPDATE就更新修改版本号

### 九、故障恢复

### 十、数据压缩算法

### 十一、分布式可能遇到的问题

### 十二、一致性问题

### 十三、分布式系统的衡量标准

### 十四、分布式系统的数据分布

### 十五、分布式系统的复制算法

### 十六、分布式事务

### 十七、分布式协调一致性算法
Paxos
ZAB


### 十八、数据集群集中部署方案

### 十九、分布式系统和集中式系统的对比

