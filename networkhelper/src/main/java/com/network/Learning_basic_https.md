### 九、HTTP ---> HTTPS  http和https的区别  
- 使用HTTP协议传输隐私信息非常不安全，数据明文传输，不加密，HTTPS是披着SSL/TSL的HTTP，有三方私钥和公钥加密，无法拦截信息，扒取信息也无法解密
- HTTP 使用TCP端口为：80 ,HTTPS 使用TCP端口默认为443
- HTTP+加密+认证+完整性保护=HTTPS
                 
### 十、什么是HTTPS
- https就是披了一层SSL认证的http协议，使用SSL建立安全的通信线路
- HTTPS使用的是共享密钥和公开私有密钥混合来进行加密的
- SSL认证是有专门的网站进行颁发的一个身份认证，基于第三方的认证机构来获取认可的证书中认证该服务器是否是合法的
- 这个第三方的数字证书正式在一次又一次对http内容加密的探索中出现的，对称加密、非对称加密都存在很多问题，第三方的数字证书很好的解决了这些问题
- 这个数字证书是第三方机构使用自己的私钥对服务器的公钥进行加密之后的密文，与当前https中的证书不同

### 十一、 ssl协议加密方式 - SSL(安全套节层)主要采取的是RSA（非对称加密）与AES（对称加密）结合的加密方式
- SSL（Secure Socket Layer，安全套接字层）
- TLS（Transport Layer Security，传输层安全）：其前身是 SSL


1.RSA 非对称加密 --- 公钥加密算法
- 一个公钥（public key），一个是私钥（private key）。公钥负责加密，而私钥负责解密
- 目前最常用的是服务端单向认证机制

2.AES 对称加密----Advanced Encryption Standard----高级加密标准
- 通过一个共同的key进行加密和解密，使用动态key可以提高安全性

#### CA证书
- CA证书是由CA机构保证颁发
1. 服务端人员使用RSA算法生成公钥私钥：一个用来加密一个用来解密，将负责加密的那个密钥公布，称为公钥，不能对外公布，只有服务端持有，称为私钥
2. 生成数字签名公钥证书：对于CA机构，有CA私钥和CA公钥。数字签名证书的本质就是服务端的公钥+CA私钥加密的Hash值。（CA私钥负责签名，CA公钥负责验证）
3. 服务器获取到这个已经含有数字签名并带有公钥的证书，将该证书发送给客户端。当客户端收到该公钥数字证书后，会验证其有效性。大部分客户端都会预装CA公钥，客户端使用CA公钥对数字证书上的签名进行验证，这个验证的过程就是使用CA公钥对CA私钥加密的内容进行解密，将解密后的内容与服务端的Public Key所生成的Hash值进行匹配，如果匹配成功，则说明该证书就是相应的服务端发过来的。否则就是非法证书
4. 验证完服务端公钥的合法性后，就可以使用该公钥进行加密通信了


#### 十二、认证方式
- 主要用到的算法:非对称加密算法(RSA DSA ECC DH)，对称加密算法（AES-CBC DES 3DES AES-GCM），Hash散列算法（MD5,SHA1,SHA256 不可逆）

- 单向认证
```text
1、客户端向服务端发送SSL协议版本号、加密算法种类、随机数等信息。

2、服务端给客户端返回SSL协议版本号、加密算法种类、随机数等信息，同时也返回服务器端的证书，即公钥证书

3、客户端使用服务端返回的信息验证服务器的合法性，包括：

证书是否过期

发型服务器证书的CA是否可靠

返回的公钥是否能正确解开返回证书中的数字签名

服务器证书上的域名是否和服务器的实际域名相匹配

验证通过后，将继续进行通信，否则，终止通信

4、客户端向服务端发送自己所能支持的对称加密方案，供服务器端进行选择

5、服务器端在客户端提供的加密方案中选择加密程度最高的加密方式

6、服务器将选择好的加密方案通过明文方式返回给客户端

7、客户端接收到服务端返回的加密方式后，使用该加密方式生成产生随机码，用作通信过程中对称加密的密钥，使用服务端返回的公钥进行加密，将加密后的随机码发送至服务器

8、服务器收到客户端返回的加密信息后，使用自己的私钥进行解密，获取对称加密密钥。 在接下来的会话中，服务器和客户端将会使用该密码进行对称加密，保证通信过程中信息的安全。
```


- 双向认证:除了客户端需要认证服务端以外，增加了服务端对客户端的认证
```text
1、客户端向服务端发送SSL协议版本号、加密算法种类、随机数等信息。

2、服务端给客户端返回SSL协议版本号、加密算法种类、随机数等信息，同时也返回服务器端的证书，即公钥证书

3、客户端使用服务端返回的信息验证服务器的合法性，包括：

证书是否过期

发型服务器证书的CA是否可靠

返回的公钥是否能正确解开返回证书中的数字签名

服务器证书上的域名是否和服务器的实际域名相匹配

验证通过后，将继续进行通信，否则，终止通信

###
4、服务端要求客户端发送客户端的证书，客户端会将自己的证书发送至服务端
###
5、验证客户端的证书，通过验证后，会获得客户端的公钥

6、客户端向服务端发送自己所能支持的对称加密方案，供服务器端进行选择

7、服务器端在客户端提供的加密方案中选择加密程度最高的加密方式

8、将加密方案通过使用之前获取到的公钥进行加密，返回给客户端

9、客户端收到服务端返回的加密方案密文后，使用自己的私钥进行解密，获取具体加密方式，而后，产生该加密方式的随机码，用作加密过程中的密钥，使用之前从服务端证书中获取到的公钥进行加密后，发送给服务端

10、服务端收到客户端发送的消息后，使用自己的私钥进行解密，获取对称加密AES的密钥，在接下来的会话中，服务器和客户端将会使用该密码进行对称加密，保证通信过程中信息的安全。
```

### 十三、http缺点及[优化](https://blog.csdn.net/hherima/article/details/52469787)
1. SSL 证书费用很高，以及其在服务器上的部署、更新维护非常繁琐
2. HTTPS 降低用户访问速度，多次握手，增加时延
3. 网站改用HTTPS 以后，由HTTP 跳转到 HTTPS 的方式增加了用户访问耗时
4. HTTPS 涉及到的安全算法会消耗 CPU 资源，需要增加大量机器 

#### 如何优化
```text
方法一：从减少传输延时和单机负载的方法提高 HTTPS 接入性能
方法二：利用 TLS/SSL 带来的优势，通过修改协议的方法来提升 HTTPS 的性能
```

1.CDN接入
- HTTPS 增加的延时主要是传输延时 RTT，RTT 的特点是节点越近延时越小，CDN 天然离用户最近，因此选择使用 CDN 作为 HTTPS 接入的入口，将能够极大减少接入延时
- CDN 节点通过和业务服务器维持长连接、会话复用和链路质量优化等可控方法，极大减少 HTTPS 带来的延时

2.会话缓存
- 会话缓存能够进行明显的延时优化
- 基于会话缓存建立的 HTTPS 连接不需要服务器使用RSA私钥解密获取 Pre-master 信息，可以省去CPU 的消耗
- 如果业务访问连接集中，缓存命中率高，则HTTPS的接入能力讲明显提升

3.硬件加速
- 为接入服务器安装专用的SSL硬件加速卡，作用类似 GPU，释放 CPU，能够具有更高的 HTTPS 接入能力且不影响业务程序的

4.远程解密
-本地接入消耗过多的 CPU 资源，浪费了网卡和硬盘等资源，考虑将最消耗 CPU 资源的RSA解密计算任务转移到其它服务器，如此则可以充分发挥服务器的接入能力，充分利用带宽与网卡资源
- 远程解密服务器可以选择 CPU 负载较低的机器充当，实现机器资源复用，也可以是专门优化的高计算性能的服务器

5.SPDY/HTTP2
-SPDY/HTTP2 利用 TLS/SSL 带来的优势，通过修改协议的方法来提升 HTTPS 的性能，提高下载速度等

### 十四、一些与https相关的名词
- openssl、x509、crt、cer、key、csr、ssl、tls
- TLS：传输层安全协议 Transport Layer Security的缩写
- SSL：安全套接字层 Secure Socket Layer的缩写
`TLS与SSL对于不是专业搞安全的开发人员来讲，可以认为是差不多的，这二者是并列关系`
[详细差异](http://kb.cnblogs.com/page/197396/)
- KEY 通常指私钥。
- CSR 是Certificate Signing Request的缩写，即证书签名请求，这不是证书，可以简单理解成公钥，生成证书时要把这个提交给权威的证书颁发机构
- CRT 即 certificate的缩写,证书
- X.509 是一种证书格式.对X.509证书来说，认证者总是CA或由CA指定的人
- X.509的证书文件，一般以.crt结尾，根据该文件的内容编码格式，可以分为以下二种格式：
- PEM - Privacy Enhanced Mail,打开看文本格式,以"-----BEGIN..."开头, "-----END..."结尾,内容是BASE64编码.Apache和*NIX服务器偏向于使用这种编码格式.
- DER - Distinguished Encoding Rules,打开看是二进制格式,不可读.Java和Windows服务器偏向于使用这种编码格式
- OpenSSL 相当于SSL的一个实现，如果把SSL规范看成OO中的接口，那么OpenSSL则认为是接口的实现。接口规范本身是安全没问题的，但是具体实现可能会有不完善的地方